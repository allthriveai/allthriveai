# Avatar Focal Point Feature Implementation Plan

## Overview
Allow users to set a focal point on their profile photo so the important part of the image (typically their face) is always visible in the circular avatar crop.

## How It Works
1. User uploads a profile photo
2. A modal appears showing the full image with a circular preview overlay
3. User can drag/pan the image to position it within the circular crop
4. Focal point (x, y coordinates as percentages 0-1) is saved to their profile
5. When displaying the avatar, CSS `object-position` is applied based on focal point

## Implementation Steps

### 1. Backend: Add focal point fields to User model
**File:** `core/users/models.py`
```python
avatar_focal_x = models.FloatField(default=0.5, help_text='Horizontal focal point (0-1, 0.5=center)')
avatar_focal_y = models.FloatField(default=0.5, help_text='Vertical focal point (0-1, 0.5=center)')
```

### 2. Backend: Create migration
```bash
make makemigrations
```

### 3. Backend: Update serializers
**File:** `core/auth/serializers.py`
- Add `avatar_focal_x` and `avatar_focal_y` to `PROFILE_FIELDS`

### 4. Frontend: Update User type
**File:** `frontend/src/types/models.ts`
```typescript
avatarFocalX?: number;  // 0-1, default 0.5
avatarFocalY?: number;  // 0-1, default 0.5
```

### 5. Frontend: Create AvatarFocalPointEditor component
**File:** `frontend/src/components/profile/AvatarFocalPointEditor.tsx`

Features:
- Modal that appears after image upload
- Shows full image with draggable positioning
- Circular preview overlay showing final crop
- Save/Cancel buttons
- Drag to pan the image within the crop area

### 6. Frontend: Update ProfileHeader component
**File:** `frontend/src/components/profile/ProfileHeader.tsx`

Changes:
- Add state to track when focal point editor should show
- After successful upload, show the focal point editor modal
- Pass focal point to avatar display

### 7. Frontend: Update ProfilePage
**File:** `frontend/src/pages/ProfilePage.tsx`

Changes:
- Update `handleAvatarChange` to:
  1. Upload image
  2. Return uploaded URL
  3. Show focal point editor
  4. Save both URL and focal point together

### 8. Apply focal point to avatar display
All avatar `<img>` elements with focal point data should use:
```tsx
<img
  src={avatarUrl}
  style={{ objectPosition: `${focalX * 100}% ${focalY * 100}%` }}
  className="object-cover"
/>
```

## UX Flow
1. User is in Edit Profile mode
2. User clicks avatar → file picker opens
3. User selects image → image uploads
4. **NEW:** Focal point editor modal appears
5. User drags image to position face in crop circle
6. User clicks "Save" → focal point saved
7. Avatar displays with correct positioning everywhere

## Files to Modify
- `core/users/models.py` - Add focal point fields
- `core/auth/serializers.py` - Expose focal point fields
- `frontend/src/types/models.ts` - Add TypeScript types
- `frontend/src/components/profile/AvatarFocalPointEditor.tsx` - **NEW** component
- `frontend/src/components/profile/ProfileHeader.tsx` - Integrate editor
- `frontend/src/pages/ProfilePage.tsx` - Update upload flow

## Component Design: AvatarFocalPointEditor

```tsx
interface AvatarFocalPointEditorProps {
  imageUrl: string;
  initialFocalX?: number;  // 0-1
  initialFocalY?: number;  // 0-1
  onSave: (focalX: number, focalY: number) => void;
  onCancel: () => void;
}
```

The editor will:
- Display the full image
- Show a circular mask/preview representing the avatar crop
- Allow dragging the image behind the mask
- Calculate focal point based on image position relative to mask center
